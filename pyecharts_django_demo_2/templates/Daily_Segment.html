<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>AdminLTE 3 | Starter</title>
<!-- <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script> -->
<script src="/static/css/admin/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/echarts.js"></script>
<link rel="stylesheet" href="/static/css/table_style.css">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="/static/css/admin/plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="/static/css/admin/dist/css/adminlte.min.css">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <!-- 日历引用的js -->
<link rel="stylesheet" href="/static/css/admin/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">

  <!-- Navbar  头部导航栏-->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="{% url 'index' %}" class="nav-link">Home</a>
      </li>
    </ul>
  </nav>


  <!-- Main Sidebar Container  侧边导航栏-->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="{% url 'index' %}" class="brand-link">
      <img src="/static/css/admin/dist/img/AdminLTELogo.png" alt="AdminLTE Logo" class="brand-image img-circle elevation-3"
           style="opacity: .8">
      <span class="brand-text font-weight-light">WRPI</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="/static/css/admin/dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
          <a href="#" class="d-block">Alexander Pierce</a>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item has-treeview menu-open">
            <a href="#" class="nav-link active">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Starter Pages
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="#" class="nav-link active">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Daily Segment</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Daily Segment_1</p>
                </a>
              </li>
            </ul>
          </li>

        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Main content form表单 -->
    <div class="content">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title">Parament</h5>

                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>

                  <button type="button" class="btn btn-tool" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
                <div class="card-body">
                <div class="row">
                  <div class="col-md-12">

                    <!-- {#表单主体#} -->
                    <div class="container-fluid">
                   <!-- <form  method="get">-->
                    <div class="row">
                      <div class="col-lg-2">
                             <div class="form-group">
                              <label>Hotel Area</label>
                              <select class="form-control select2" style="width: 100%;" name="Hotel_Area" id="Hotel_Area">
<!--                                 <option>EAST CHINA</option>
                                <option>WEST CHINA </option>
                                <option>SOUTH CHINA REGION</option>
                                <option>NORTH CHINA REGION</option> -->
                              </select>
                            </div>
                      </div>


                     <div class="col-lg-2">
                         <div class="form-group">
                              <label>Hotel Brand</label>
                              <select class="form-control select2" style="width: 100%;" name="Hotel_Brand" id="Hotel_Brand">

                              </select>
                         </div>
                      </div>

                      <div class="col-lg-2">
                         <div class="form-group">
                              <label>Hotel City</label>
                              <select class="form-control select2" style="width: 100%;" name="Hotel_City" id="Hotel_City">

                              </select>
                         </div>
                      </div>

                      <div class="col-lg-2">
                         <div class="form-group">
                              <label>Hotel Owner</label>
                              <select class="form-control select2" style="width: 100%;" name="Hotel_Owner" id="Hotel_Owner">

                              </select>
                         </div>
                      </div>


                       <div class="col-lg-2">
                         <div class="form-group" style="margin-top: 32px">
                              <button class="button1" >Refresh</button>
                         </div>
                      </div>
            <!-- {#row的结束标签#} -->
                   </div>

                        <!-- {# 筛选键的第二行#} -->
                      <div class="row">
                      <div class="col-lg-2">
                             <div class="form-group">
                                  <label>Hotel Name</label>
                                  <select class="form-control select2" style="width: 100%;" name="Hotel_Name" id="Hotel_Name" >
<!--                                         <option>ALL</option>
                                        <option>Hotel A</option>
                                        <option>Hotel B</option>
                                        <option>Hotel C</option>
                                        <option>Hotel D</option> -->
                                  </select>
                            </div>
                      </div>


{#                          日历#}
                      <div class="col-lg-2">
                          <div class="form-group">
                              <label>Date:</label>
                                <div class="input-group date" id="reservationdate" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#reservationdate" id="aDate"/>
                                    <div class="input-group-append" data-target="#reservationdate" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                      </div>

                     <div class="col-lg-1">
                         <div class="form-group">
                            <label>Year</label>
                              <select class="form-control select2" style="width: 100%;" name="Business_Year" id="Business_Year">
<!--                                     <option>2020</option>
                                    <option>2019</option>
                                    <option>2018</option> -->
                              </select>
                         </div>
                      </div>

                      <div class="col-lg-1">
                         <div class="form-group">
                              <label>Month</label>
                              <select class="form-control select2" style="width: 100%;" name="Business_Month" id="Business_Month">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                    <option>6</option>
                                    <option>7</option>
                                    <option>8</option>
                                    <option>9</option>
                                    <option>10</option>
                                    <option>11</option>
                                    <option>12</option>
                              </select>
                         </div>
                      </div>


            <!-- {#row的结束标签#} -->
                   </div>
                <!--  </form>-->
                    <!-- /.row -->
                  </div>
                  </div>
                </div>
                </div>
     <!-- Main content form表单结束 -->
        </div>
    </div>
  <!-- /.content-wrapper -->


        <!--图表模块——————————————————————————————————————————————-->
      <div class="content">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <!-- -header -->
              <div class="card-header"> 
                <h5 class="card-title">Chart</h5>
                <div class="card-tools">    
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
       
                  <button type="button" class="btn btn-tool" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <div class="row">
                  <div class="col-md-12">
                        <!--柱状图 -->
                        <div id="bar" style=" height:300px;" ></div>
                  </div>
                </div>
                <!-- /.row -->
              </div>
            </div>
          </div>
        </div>   
      </div>    

    <!--表格模块————————————————————————————————————————    -->
      <div class="content">
        <div class="row">
          <div class="col-md-12">
            <div class="card">
               <!-- card-header -->
              <div class="card-header"> 
                <h5 class="card-title">Report</h5>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="collapse">
                    <i class="fas fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-tool" data-card-widget="remove">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <div class="row">
                  <div class="col-md-12">
                        <!--表格 -->
                      <table class="gridtable"></table>  
                  </div>
                </div>  
              </div>

            <div>
          </div>
        </div>
       </div>
        </div>
      </div>

  </div>


    <!--日历控件自动获取当天日期或者前一天日期————————————————————————————————————————    -->
<script type="text/javascript">
        var mydateInput = document.getElementById("aDate");
        var curDate = new Date();
        var date = new Date(curDate.getTime() - 24*60*60*1000);
        var dateString = date.getFullYear() + "/" + (date.getMonth() + 1) + "/" + date.getDate();
        mydateInput.value = dateString;
</script>






    <!--ajax获取参数数据————————————————————————————————————————    -->

<script>

$(function () {get_Par_Data();}
);

function get_Par_Data() {
$.ajax({
   type: "GET",
   url: "http://127.0.0.1:8000/demo/Daily_Segment_Par/",
   dataType: 'json',
   //data:{"param":param}
   success: function (result) {      
      for (i=0;i<result.Hotel_Name_Value.length;i++){
      $("#Hotel_Name").append("<option>"+result.Hotel_Name_Value[i]+"</option>")}

      for (i=0;i<result.Hotel_Area_Value.length;i++){
      $("#Hotel_Area").append("<option>"+result.Hotel_Area_Value[i]+"</option>")}

      for (i=0;i<result.Hotel_Brand_Value.length;i++){
      $("#Hotel_Brand").append("<option>"+result.Hotel_Brand_Value[i]+"</option>")}

      for (i=0;i<result.Hotel_City_Value.length;i++){
      $("#Hotel_City").append("<option>"+result.Hotel_City_Value[i]+"</option>")}

      for (i=0;i<result.Hotel_Owner_Value.length;i++){
      $("#Hotel_Owner").append("<option>"+result.Hotel_Owner_Value[i]+"</option>")}

      for (i=0;i<result.Business_Year_Value.length;i++){
      $("#Business_Year").append("<option>"+result.Business_Year_Value[i]+"</option>")}
      // $("#Hotel_Area").append(par['Hotel_Area_Value'])
        //追加tr标签，以便循环遍历数据，全部生成表格
           }});
               }

</script>  

    <!--ajax获取图表和Table数据————————————————————————————————————————    -->
<script>


var chart = echarts.init(document.getElementById('bar'), 'white', {renderer: 'canvas'});

$(".button1").click(function () {
    $(function () {
    getData();
    });
    //<!--获取页面参数————————————————————————————————————————    -->
    var Business_Year = $("#Business_Year").val();
    var Business_Month = $("#Business_Month").val();
    var Hotel_Name = $('#Hotel_Name').val();

    var Hotel_Area = $("#Hotel_Area").val();
    var Hotel_Brand = $("#Hotel_Brand").val();
    var Hotel_City = $("#Hotel_City").val();
    var Hotel_Owner = $("#Hotel_Owner").val();

    function getData() {
    $.ajax({
      type: "GET",
      url: "http://127.0.0.1:8000/demo/Daily_Segment_Data/?param="+Hotel_Name+","+Business_Year+","+Business_Month+","+Hotel_Area+","+Hotel_Brand+","+Hotel_City+","+Hotel_Owner+"",
      dataType: 'json',
      success: function (result) {
           chart.setOption(result.data);
          {#console.log(JSON.stringify(result.data));#}
          html_str = '';

            //追加tr标签，以便循环遍历数据，全部生成表格
            html_str +='<tr>';
            //获取标头
            html_str += "<th >Segment</th><th>Section</th>";
            var raw_data = result.raw_data.columns;//表头
            for (var i = 0; i <raw_data.length; i++) {
                html_str += "<th>"+raw_data[i]+"</th>";
                }
            //获取row
            //var index_list = result.raw_data.index;
            var index2 = ['BAR','BAR','BAR','Package','Package','Package','Promotion','Promotion','Promotion','Online Wholesale','Online Wholesale','Online Wholesale','Consortia','Consortia','Consortia','Retail Total','Retail Total','Retail Total','Negotiated Rates A','Negotiated Rates A','Negotiated Rates A','Negotiated Rates B','Negotiated Rates B','Negotiated Rates B','Negotiated Rates C','Negotiated Rates C','Negotiated Rates C','SpecialRates','SpecialRates','SpecialRates','Corporate Total','Corporate Total','Corporate Total','Wholesale','Wholesale','Wholesale','Traditional WHL Total','Traditional WHL Total','Traditional WHL Total','Management-Discount','Management-Discount','Management-Discount','Wanda Award','Wanda Award','Wanda Award','Long Stay','Long Stay','Long Stay','Permanent','Permanent','Permanent','FIT Others Total','FIT Others Total','FIT Others Total','Individual Total','Individual Total','Individual Total','Corp. Meeting With Function','Corp. Meeting With Function','Corp. Meeting With Function','Corp. Meeting Without Function','Corp. Meeting Without Function','Corp. Meeting Without Function','Group Incentive','Group Incentive','Group Incentive','Group Convention','Group Convention','Group Convention',"Group Others","Group Others",'Group Others',"Contracted Crew","Contracted Crew",'Contracted Crew',"Group Corporate Total","Group Corporate Total",'Group Corporate Total',"Tour Series","Tour Series",'Tour Series',"Tour Ad Hoc(ADH)","Tour Ad Hoc(ADH)",'Tour Ad Hoc(ADH)',"Group LeisureTotal","Group LeisureTotal",'Group LeisureTotal',"Group Total","Group Total",'Group Total',"Mgt. Approved Comp & HUS","Mgt. Approved Comp & HUS",'Mgt. Approved Comp & HUS',"Mgt. Approved Comp & HUS","Mgt. Approved Comp & HUS",'Mgt. Approved Comp & HUS',"Other Revenue","Other Revenue",'Other Revenue',"Service Charge","Service Charge",'Service Charge',"Others Total","Others Total",'Others Total',"Total Paid Room","Total Paid Room",'Total Paid Room',"Total Room","Total Room",'Total Room',"Vacant","Occ"];
            //列头
            var index_list = ["RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","ADR","REV","RNs","RMs"];
            //数据部分
            var data_list = result.raw_data.data;
            for (var d=0;d<data_list.length;d++){
                html_str += '<tr>';
                //最后两行数据不做合并，先判断不做合并行数的索引
                if (d >=111 ){
                    html_str+='<th>'+index2[d]+'</th>';
                }
                //判断列表长度除三余数是否为0，是为了合并上下单元格，必须先做合并索引范围判断，再做余数判断
                if(d<111 ){
                    if (d % 3 ===0){
                       html_str+='<th rowspan="3">'+index2[d]+'</th>';
                    }
                }
                //此行是追加行头，行头必须和值再一个tr
                html_str+='<th class="th1" > '+index_list[d]+'</th>';

                for (var a=0;a<data_list[d].length;a++){
                    html_str +="</th><td>"+ data_list[d][a]+"</td>";
                }
            }
             html_str += '</tr>';

            $('.gridtable').html(html_str);
               }});

              }
          })
</script>


<script>
  $(function () {
    //Date range picker
    $('#reservationdate').datetimepicker({
        format: 'Y-M-D'
    });
  })

</script>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
    <div class="p-3">
      <h5>Title</h5>
      <p>Sidebar content</p>
    </div>
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <!-- To the right -->
    <div class="float-right d-none d-sm-inline">
      Anything you want
    </div>
    <!-- Default to the left -->
    <strong>Copyright &copy; 2014-2019 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
  </footer>
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<!-- Bootstrap 4 -->
<script src="/static/css/admin/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="/static/css/admin/dist/js/adminlte.min.js"></script>
{#引入日历js#}

<script src="/static/css/admin/plugins/moment/moment.min.js"></script>
<script src="/static/css/admin/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>


</body>
</html>
